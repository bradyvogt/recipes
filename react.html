<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        header {
            background-color: #ecf8ef;
            color: #246231;
            padding: 10px 20px;
            text-align: center;
        }
        .recipes-container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .search-bar, .sort-bar, .ingredient-bar {
            margin-bottom: 20px;
        }
        .search-bar input, .ingredient-bar select, .sort-bar button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        ul li {
            background: #f9f9f9;
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background 0.3s;
            cursor: pointer;
        }
        
        ul li:hover {
            background: #ffefef;
        }
        
        .recipe-header {
            display: flex; /* Use flexbox for layout */
            justify-content: space-between; /* Space out content */
            align-items: center; /* Center items vertically */
            gap: 10px; /* Add spacing between items */
        }

        .recipe-title {
            font-size: 1.5em;
            font-weight: bold;
            flex: 1; /* Allow title to take up available space */
            margin: 0; /* Reset default margins */
            white-space: pre-wrap; /* Prevent wrapping */
            overflow: hidden; /* Hide overflow text */
            text-overflow: ellipsis; /* Add ellipsis for long titles */
        }

        h2 {
            font-size: 0.8em;
        }

        h3 {
            font-size: 0.8em;
            margin: 0;
            white-space: nowrap; /* Prevent wrapping */
            text-align: right; /* Align content to the right */
        }
        
        .toggle-container{
            margin: 10px 0;
            padding: 15px;
            justify-content: space-between;
            background-color: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
        }

        .toggle-container:hover {
            background-color: #ccd7cf;
        }

        .toggle-details-container {
            margin-top: 10px;
            padding: 10px;
            background: #ecf8ef;
            border: 1px solid #246231;
            border-radius: 4px;
        }

    </style>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<body>
    <header>
        <h1>Recipe Viewer</h1>
    </header>
    <div id="reactRoot" class="recipes-container"></div>

    <script src="data.js"></script>
    <script src="data_actions.js"></script>

    <script type="text/babel">
        const { useState } = React;

        const ToggleContainer = ({ header, details }) => {
            const [isVisible, setIsVisible] = useState(false);

            const toggleDetails = () => setIsVisible(!isVisible);

            return (
                <div className="toggle-container">
                    <div className="toggle-header-container" onClick={toggleDetails} >
                        {header}
                    </div>
                    {isVisible && (
                        <div className="toggle-details-container">
                            {details}
                        </div>
                    )}
                </div>
            );
        };

        const recipesReact = getRecipes();
        const sampleRecipe = recipesReact[0];

        const IconMetric = ({ icon, label }) => {
            return (
                <div className="icon-label" style={{ display: 'flex', alignItems: 'center', gap: '5px'}}>
                    <div className="icon-half">
                        <img src={icon} alt="icon" style={{ width: '30px', height: '30px' }} />
                    </div>
                    <div className="label-half">
                        <h4 style={{margin: '0'}}>{label}</h4>
                    </div>
                </div>
            );
        };


        const RecipeSummary = ({ recipe }) => {
            return (
                <div className="recipe-header">
                    <h2 className="recipe-title">{recipe.title}</h2>
                    {recipe.servings && (<IconMetric icon={ 'servings.svg' } label={ recipe.servings } />)}
                    {getTotalCookTime(recipe) ? (<IconMetric icon={ 'clock.svg' } label={ formatTime(getTotalCookTime(recipe)) } />):''}
                </div>
            );
        };

        // Top Level Recipe List
        const RecipeList = ({ recipes }) => {
            console.log(recipes.length);    
            return (
                <div>
                    {   
                        // List of recipe info boxes
                        recipes.map(recipe => (
                            <ToggleContainer key={recipe.id}
                                header = {
                                    <RecipeSummary key={recipe.id} recipe={recipe}/>
                                }
                                details = {
                                    <div>
                                        <div style={{ display: 'flex', justifyContent: 'center', gap: '20px' }}>
                                            {recipe.prep_time > 0 && (<IconMetric icon={ 'prep_time.svg' } label={ formatTime(recipe.prep_time) } />)}
                                            {recipe.cook_time > 0 && formatTime(recipe.cook_time) && (<IconMetric icon={ 'cook_time.svg' } label={ formatTime(recipe.cook_time) } />)}
                                        </div>

                                        {recipe.ingredients && (
                                            <>
                                                <h4>Ingredients</h4>
                                                <ul>
                                                {
                                                    recipe.ingredients.map(ingredient => (
                                                        <li>{formatIngredient(ingredient)}</li>
                                                    ))
                                                }
                                                </ul>
                                            </>
                                        )}

                                        {recipe.instructions && (
                                            <>
                                                <h4>Instructions</h4>
                                                <ul>
                                                {
                                                    recipe.instructions.map(instruction => (
                                                        <li>{instruction}</li>
                                                    ))
                                                }
                                                </ul>
                                            </>
                                        )}
                                    </div>
                                }
                            />
                        ))
                    }
                </div>
            );
        };

        // render at the root
        const container = document.getElementById('reactRoot');
        const root = ReactDOM.createRoot(container);
        root.render(<RecipeList recipes = { recipesReact } />)
    </script>

  </body>
</html>

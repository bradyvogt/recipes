<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Viewer</title>
    <link rel="stylesheet" href="common.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<body>
    <header>
        <h1>Recipe Viewer</h1>
    </header>

    <a href="ingredients.html?recipes=1" target="_blank">Ingredients Page</a>

    <div id="reactRoot" class="recipes-container"></div>

    <script src="data.js"></script>
    <script src="data_actions.js"></script>

    <script type="text/babel">
        const { useState } = React;

        const ToggleContainer = ({ header, details }) => {
            const [isVisible, setIsVisible] = useState(false);

            const toggleDetails = () => setIsVisible(!isVisible);

            return (
                <div className="toggle-container">
                    <div className="toggle-header-container" onClick={toggleDetails} >
                        {header}
                    </div>
                    {isVisible && (
                        <div className="toggle-details-container">
                            {details}
                        </div>
                    )}
                </div>
            );
        };

        const recipesReact = getRecipes();
        const sampleRecipe = recipesReact[0];

        const IconMetric = ({ icon, label }) => {
            return (
                <div className="icon-label" style={{ display: 'flex', alignItems: 'center', gap: '5px'}}>
                    <div className="icon-half">
                        <img src={icon} alt="icon" style={{ width: '30px', height: '30px' }} />
                    </div>
                    <div className="label-half">
                        <h4 style={{margin: '0'}}>{label}</h4>
                    </div>
                </div>
            );
        };


        const RecipeSummary = ({ recipe }) => {
            return (
                <div className="recipe-header">
                    <h2 className="recipe-title">{recipe.title}</h2>
                    {recipe.servings && (<IconMetric icon={ 'servings.svg' } label={ recipe.servings } />)}
                    {getTotalCookTime(recipe) ? (<IconMetric icon={ 'clock.svg' } label={ formatTime(getTotalCookTime(recipe)) } />):''}
                </div>
            );
        };

        // Top Level Recipe List
        const RecipeList = ({ recipes }) => {
            console.log(recipes.length);    
            return (
                <div>
                    {   
                        // List of recipe info boxes
                        recipes.map(recipe => (
                            <ToggleContainer key={recipe.id}
                                header = {
                                    <RecipeSummary key={recipe.id} recipe={recipe}/>
                                }
                                details = {
                                    <div>
                                        <div style={{ display: 'flex', justifyContent: 'center', gap: '20px' }}>
                                            {recipe.prep_time > 0 && (<IconMetric icon={ 'prep_time.svg' } label={ formatTime(recipe.prep_time) } />)}
                                            {recipe.cook_time > 0 && formatTime(recipe.cook_time) && (<IconMetric icon={ 'cook_time.svg' } label={ formatTime(recipe.cook_time) } />)}
                                        </div>

                                        {recipe.ingredients && (
                                            <>
                                                <h4>Ingredients</h4>
                                                <ul>
                                                {
                                                    recipe.ingredients.map(ingredient => (
                                                        <li>{formatIngredient(ingredient)}</li>
                                                    ))
                                                }
                                                </ul>
                                            </>
                                        )}

                                        {recipe.instructions && (
                                            <>
                                                <h4>Instructions</h4>
                                                <ul>
                                                {
                                                    recipe.instructions.map(instruction => (
                                                        <li>{instruction}</li>
                                                    ))
                                                }
                                                </ul>
                                            </>
                                        )}
                                    </div>
                                }
                            />
                        ))
                    }
                </div>
            );
        };

        // render at the root
        const container = document.getElementById('reactRoot');
        const root = ReactDOM.createRoot(container);
        root.render(<RecipeList recipes = { recipesReact } />)
    </script>

  </body>
</html>
